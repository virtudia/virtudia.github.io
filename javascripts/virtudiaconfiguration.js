(function () {
function getCookie(e){let o=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return o?decodeURIComponent(o[2]):null}
function updateConsentMode(a){window.gtag=window.gtag||function(){window.dataLayer.push(arguments)},gtag("consent","update",{ad_storage:a.advertising?"granted":"denied",ad_user_data:a.advertising?"granted":"denied",ad_personalization:a.advertising?"granted":"denied",analytics_storage:a.analytical?"granted":"denied"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"consent_updated",consent_analytical:!0===a.analytical,consent_advertising:!0===a.advertising})}
function saveConsentChoices(e){let n=window.aCBm?.cookieBanner?.getBannerSuffix?.()||"";Object.entries(e).forEach(function(e){localStorage.setItem("virtudiacc_"+e[0]+n,!0===e[1]?"true":"false")});let t={necessary:!0,analytical:!0===e.analytical,advertising:!0===e.advertising};localStorage.setItem("cookie_consent"+n,JSON.stringify(t)),updateConsentMode(t),fetch("https://www.virtudia.com/set-consent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}).catch(e=>{console.error("Failed to send consent to server:",e)}),window.dataLayer.push({event:"consent_updated",consent_necessary:!0,consent_analytical:t.analytical,consent_advertising:t.advertising}),console.debug("Consent successfully saved and sent:",t)}
function syncConsentFromCookie(){let e=window.aCBm?.cookieBanner?.getBannerSuffix?.()||"";Object.keys(localStorage).forEach(function(e){e.startsWith("cookie_consent")&&"undefined"===localStorage.getItem(e)&&(console.warn("Deleting invalid keys from localStorage:",e),localStorage.removeItem(e))});let t;try{let n=localStorage.getItem(`cookie_consent${e}`);n&&"undefined"!==n&&(t=JSON.parse(n))}catch(a){console.warn("Failed to parse from localStorage:",a)}if(!t||"object"!=typeof t||!("necessary"in t)){let s=getCookie("cookie_consent");try{s&&"undefined"!==s&&(t=JSON.parse(s))}catch(o){console.warn("Failed to parse from cookie:",o)}}if(!t||"object"!=typeof t||!("necessary"in t)){console.warn("Invalid consent. Not re-saved.");return}localStorage.setItem(`cookie_consent${e}`,JSON.stringify(t)),localStorage.setItem(`virtudiacc_necessary${e}`,"true"),localStorage.setItem(`virtudiacc_analytical${e}`,t.analytical?"true":"false"),localStorage.setItem(`virtudiacc_advertising${e}`,t.advertising?"true":"false"),updateConsentMode(t),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"consent_synced_from_cookie",consent_necessary:!0,consent_analytical:!0===t.analytical,consent_advertising:!0===t.advertising}),console.debug("Consent successfully synced from valid source:",t)}
function applyConsentChoices(e){let o=window.aCBm?.cookieBanner?.config?.cookieTypes||[];o.forEach(o=>{let c=e[o.id];if(c&&"function"==typeof o.onAccept)try{o.onAccept()}catch(n){console.warn(`Error onAccept ${o.id}:`,n)}else if(!c&&"function"==typeof o.onReject)try{o.onReject()}catch(t){console.warn(`Error onReject ${o.id}:`,t)}}),console.debug("Consent is applied:",e)}
document.addEventListener("consent_updated",e=>{let t=e.detail;saveConsentChoices(t),applyConsentChoices(t)});
document.addEventListener("consent_given",e=>{let n=e.detail;saveConsentChoices(n),applyConsentChoices(n)});
!function e(){window.aCBm?.updateCookieBannerConfig&&window.gtag?(syncConsentFromCookie(),window.aCBm.updateCookieBannerConfig({onClickAccept:()=>console.debug("Click: Accept all"),onClickReject:()=>console.debug("Click: Reject non-essential"),onClickPreferences:()=>console.debug("Click: Open preferences"),onConsentGiven(){let e=window.aCBm?.cookieBanner?.getBannerSuffix?.()||"",t={necessary:!0,analytical:"true"===localStorage.getItem(`virtudiacc_analytical${e}`),advertising:"true"===localStorage.getItem(`virtudiacc_advertising${e}`)};window.dataLayer.push({event:"consent_given",consent_necessary:!0,consent_analytical:t.analytical,consent_advertising:t.advertising}),console.debug("Granular consent is given:",t)},saveConsentChoices,applyConsentChoices,cookieTypes:[{id:"necessary",name:"Necessary",description:"<p>These cookies are essential for the website to function and cannot be disabled in our systems. They are typically set only in response to actions you take, such as requesting services. You can configure your browser to block or alert you about these cookies, but some parts of the site may not work properly. These cookies do not store any personally identifiable information.</p>",required:!0,onAccept:()=>console.debug("Necessary is activated")},{id:"analytical",name:"Analytical",description:"<p>These cookies help us understand how the site performs by counting visits, tracking traffic sources, and identifying the most popular pages and how users navigate. The data collected is anonymous and aggregated. If you don’t allow these cookies, we won’t be able to monitor site performance or know when you’ve visited.</p>",required:!1,onAccept:()=>updateConsentMode({analytical:!0}),onReject:()=>updateConsentMode({analytical:!1})},{id:"advertising",name:"Targeted Advertising",description:"<p>These cookies are used to deliver ads that match your interests. We, along with our advertising partners, may collect data like browsing behavior, preferences, and location to tailor the ads you see. By allowing these cookies, you’ll get ads that better suit your needs. If you disable them, you’ll still see ads, but they may be less relevant.</p>",required:!1,onAccept:()=>updateConsentMode({advertising:!0}),onReject:()=>updateConsentMode({advertising:!1})}],text:{banner:{title:"Your privacy matters to us.",description:"<p>We process your personal information to measure and improve our site and services, to assist with our marketing campaigns, and to provide personalized content and advertising. For more information, see our <a href='https://www.virtudia.com/policies/privacy' target='_blank'>Privacy Policy</a>.</p>",acceptAllButtonText:"Accept all",rejectNonEssentialButtonText:"Reject non-essential"},preferences:{title:"Manage Consent Preferences",description:"<p>We respect your right to privacy. You have control over how we improve and personalize your experience. Therefore, you can choose not to allow some types of cookies. Your cookie preferences will apply across our website.</p>"}},position:{banner:"bottomLeft"},background:{showBackground:!0}}),console.debug("Virtudia Consent Manager initialized")):setTimeout(e,50)}();})();