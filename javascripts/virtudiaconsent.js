class ACB{constructor(e){this.config={cookieTypes:[],...e},Array.isArray(this.config.cookieTypes)||(console.warn("config.cookieTypes is not an array, uses an empty array as default"),this.config.cookieTypes=[]),this.wrapper=null,this.banner=null,this.modal=null,this.cookieIcon=null,this.backdrop=null,this.randomSuffix=null,this.modalEventListeners=null,this.bannerEventListeners=null,this.cookieIconEventListener=null,this.createWrapper(),this.shouldShowBackdrop()&&this.createBackdrop(),this.createCookieIcon(),this.createModal(),this.shouldShowBanner()?(this.createBanner(),this.showBackdrop()):this.showCookieIcon(),this.setupEventListeners(),this.hasSetInitialCookieChoices()&&(this.loadRequiredCookies(),this.runAcceptedCookieCallbacks())}handleCookieChoice(e){this.setInitialCookieChoiceMade(),this.removeBanner(),this.hideBackdrop(),this.toggleModal(!1),this.showCookieIcon();let t={};if(this.config.cookieTypes.forEach(n=>{let o=!!n.required||e;if(t[n.id]=o,localStorage.setItem(`virtudiacc_${n.id}${this.getBannerSuffix()}`,o.toString()),o&&"function"==typeof n.onAccept)try{n.onAccept()}catch(i){console.warn(`Error running onAccept for ${n.id}:`,i)}else if(!o&&"function"==typeof n.onReject)try{n.onReject()}catch(s){console.warn(`Error running onReject for ${n.id}:`,s)}}),e&&"function"==typeof this.config.onAcceptAll?this.config.onAcceptAll():e||"function"!=typeof this.config.onRejectAll||this.config.onRejectAll(),"function"==typeof this.config.saveConsentChoices)try{this.config.saveConsentChoices(t)}catch(n){console.warn("Error running saveConsentChoices:",n)}if("function"==typeof this.config.applyConsentChoices)try{this.config.applyConsentChoices(t)}catch(o){console.warn("Error running applyConsentChoices:",o)}e&&"function"==typeof this.config.onConsentGiven?this.config.onConsentGiven():e||"function"!=typeof this.config.onConsentRejected||this.config.onConsentRejected(),this.updateCheckboxState(),console.debug("Cookie options are saved:",t)}createBanner(){this.banner=this.createWrapperChild(this.getBannerContent(),"aBn"),this.banner&&this.config.position?.banner&&(["bottomLeft"].includes(this.config.position.banner)?this.banner.classList.add(this.config.position.banner):(console.warn(`Invalid banner position: ${this.config.position.banner}. Using default.`),this.banner.classList.add("bottomLeft"))),this.banner&&"function"==typeof this.config.onBannerOpen&&this.config.onBannerOpen()}createWrapper(){this.wrapper=document.createElement("div"),this.wrapper.id="AWr",document.body.insertBefore(this.wrapper,document.body.firstChild)}updateCheckboxState(e=!1){let t=this.modal.querySelector("#cookie-preferences"),n=t.querySelectorAll('input[type="checkbox"]'),o=new Map(this.config.cookieTypes.map(e=>[e.id,e]));n.forEach(t=>{let[,n]=t.id.split("cookies-")[1].split(`-${this.randomSuffix}`),i=o.get(n);if(!i){console.warn(`Cookie type ${n} not found`);return}if(e){let s=t.checked;if(i.required)localStorage.setItem(`virtudiacc_${n}${this.getBannerSuffix()}`,"true");else if(localStorage.setItem(`virtudiacc_${n}${this.getBannerSuffix()}`,s.toString()),s&&"function"==typeof i.onAccept)try{i.onAccept()}catch(c){console.warn(`Error running onAccept for ${n}:`,c)}else if(!s&&"function"==typeof i.onReject)try{i.onReject()}catch(r){console.warn(`Error running onReject for ${n}:`,r)}}else if(i.required)t.checked=!0,t.disabled=!0;else{let a=localStorage.getItem(`virtudiacc_${n}${this.getBannerSuffix()}`);null!==a?t.checked="true"===a:t.checked=!!i.defaultValue}})}getModalContent(){let e=this.config.text?.preferences?.title||"Manage Consent Preferences",t=this.config.text?.preferences?.description||"<p>We respect your right to privacy. You have control over how we improve and personalize your experience. Therefore, you can choose not to allow some types of cookies. Your cookie preferences will apply across our website.</p>",n=`<button class="modal-close" aria-label="Close Preferences Modal"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.4081 3.41559C20.189 2.6347 20.189 1.36655 19.4081 0.585663C18.6272 -0.195221 17.3591 -0.195221 16.5782 0.585663L10 7.17008L3.41559 0.59191C2.6347 -0.188974 1.36655 -0.188974 0.585663 0.59191C-0.195221 1.37279 -0.195221 2.64095 0.585663 3.42183L7.17008 10L0.59191 16.5844C-0.188974 17.3653 -0.188974 18.6335 0.59191 19.4143C1.37279 20.1952 2.64095 20.1952 3.42183 19.4143L10 12.8299L16.5844 19.4081C17.3653 20.189 18.6335 20.189 19.4143 19.4081C20.1952 18.6272 20.1952 17.3591 19.4143 16.5782L12.8299 10L19.4081 3.41559Z"/></svg></button>`,o=this.config.cookieTypes||[],i=this.getAcceptedCookies(),s=this.config.text?.banner?.acceptAllButtonText||"Accept all",c=this.config.text?.banner?.acceptAllButtonAccessibleLabel,r=`<button class="accept-all abTn abTnP"${c&&c!==s?` aria-label="${c}"`:""}>${s}</button>`,a=this.config.text?.banner?.rejectNonEssentialButtonText||"Reject non-essential",l=this.config.text?.banner?.rejectNonEssentialButtonLabel,h=`<button class="reject-all abTn abTnS"${l&&l!==a?` aria-label="${l}"`:""}>${a}</button>`;this.randomSuffix=Math.random().toString(36).substr(2,6);let f=`<header><h1>${e}</h1>${n}</header>${t}<section id="cookie-preferences">${o.map(e=>{let t=i[e.id],n=!1;return t&&(n=!0),t||this.hasSetInitialCookieChoices()||(n=e.defaultValue),`<fieldset><div class="ctt"><legend>${e.name}</legend><label class="switch" for="cookies-${e.id}-${this.randomSuffix}"><input type="checkbox" id="cookies-${e.id}-${this.randomSuffix}" ${e.required?"checked disabled":n?"checked":""} /><span class="switch__pill" aria-hidden="true"></span><span class="switch__dot" aria-hidden="true"></span><span class="switch__off" aria-hidden="true">Off</span><span class="switch__on" aria-hidden="true">On</span></label></div><div class="ctc"><div class="ctd">${e.description}</div></div></fieldset>`}).join("")}</section><footer>${r}${h}<button class="save-preferences abTn abTnS">Save preferences</button></footer>`;return f}setupModalEventListeners(){let e=this.modal.querySelector(".modal-close"),t=this.modal.querySelector(".accept-all"),n=this.modal.querySelector(".reject-all"),o=this.modal.querySelector(".save-preferences");this.modalEventListeners=[];let i=(e,t,n)=>{e&&(e.addEventListener(t,n),this.modalEventListeners.push({element:e,event:t,handler:n}))};i(e,"click",()=>{this.toggleModal(!1);let e=this.hasSetInitialCookieChoices();e?this.runStoredCookiePreferenceCallbacks():this.handleClosedWithNoChoice()}),i(t,"click",()=>this.handleCookieChoice(!0)),i(n,"click",()=>this.handleCookieChoice(!1)),i(o,"click",()=>{let e={};if(this.config.cookieTypes.forEach(t=>{let n=document.getElementById(`cookies-${t.id}-${this.randomSuffix}`);if(!n){console.warn(`Checkbox for cookie ${t.id} not found`);return}e[t.id]=!!t.required||n.checked,localStorage.setItem(`virtudiacc_${t.id}${this.getBannerSuffix()}`,e[t.id].toString())}),"function"==typeof this.config.saveConsentChoices)try{this.config.saveConsentChoices(e)}catch(t){console.warn("Error running saveConsentChoices:",t)}if("function"==typeof this.config.applyConsentChoices)try{this.config.applyConsentChoices(e)}catch(n){console.warn("Error running applyConsentChoices:",n)}this.toggleModal(!1),console.debug("Preferences are saved from modal:",e)});let s=this.modal.querySelector("#cookie-preferences"),c=s.querySelectorAll('input[type="checkbox"]');c.forEach(e=>{let t=e=>{let[,t]=e.target.id.split("cookies-")[1].split(`-${this.randomSuffix}`),n=e.target.checked,o="true"===localStorage.getItem(`virtudiacc_${t}${this.getBannerSuffix()}`);if(n!==o){let i=this.config.cookieTypes.find(e=>e.id===t);if(i){if(localStorage.setItem(`virtudiacc_${t}${this.getBannerSuffix()}`,n.toString()),n&&"function"==typeof i.onAccept)try{i.onAccept()}catch(s){console.warn(`Error running onAccept for ${t}:`,s)}else if(!n&&"function"==typeof i.onReject)try{i.onReject()}catch(c){console.warn(`Error running onReject for ${t}:`,c)}}}};e.addEventListener("change",t),this.modalEventListeners.push({element:e,event:"change",handler:t})}),this.setupFocusTrap(this.modal,e)}destroyCookieBanner(){this.modalEventListeners&&(this.modalEventListeners.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this.modalEventListeners=null),this.bannerEventListeners&&(this.bannerEventListeners.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),this.bannerEventListeners=null),this.cookieIconEventListener&&(this.cookieIcon.removeEventListener("click",this.cookieIconEventListener),this.cookieIconEventListener=null),this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.allowBodyScroll(),this.wrapper=null,this.banner=null,this.modal=null,this.cookieIcon=null,this.backdrop=null,this.randomSuffix=null}createWrapperChild(e,t){let n=document.createElement("div");return n.id=t,n.innerHTML=e,this.wrapper&&document.body.contains(this.wrapper)||this.createWrapper(),this.wrapper.appendChild(n),n}createBackdrop(){this.backdrop=this.createWrapperChild(null,"ABd")}showBackdrop(){this.backdrop&&(this.backdrop.style.display="block"),"function"==typeof this.config.onBackdropOpen&&this.config.onBackdropOpen()}hideBackdrop(){this.backdrop&&(this.backdrop.style.display="none"),"function"==typeof this.config.onBackdropClose&&this.config.onBackdropClose()}shouldShowBackdrop(){return this.config?.background?.showBackground||!1}setInitialCookieChoiceMade(){window.localStorage.setItem(`ACBic${this.getBannerSuffix()}`,1)}getAcceptedCookies(){return(this.config.cookieTypes||[]).reduce((e,t)=>(e[t.id]="true"===localStorage.getItem(`virtudiacc_${t.id}${this.getBannerSuffix()}`),e),{})}runAcceptedCookieCallbacks(){if(!this.config.cookieTypes)return;let e=this.getAcceptedCookies();this.config.cookieTypes.forEach(t=>{if(!t.required&&e[t.id]&&"function"==typeof t.onAccept)try{t.onAccept()}catch(n){console.warn(`Error running onAccept for ${t.id}:`,n)}})}runRejectedCookieCallbacks(){if(!this.config.cookieTypes)return;let e=this.getRejectedCookies();this.config.cookieTypes.forEach(t=>{if(e[t.id]&&"function"==typeof t.onReject)try{t.onReject()}catch(n){console.warn(`Error running onReject for ${t.id}:`,n)}})}runStoredCookiePreferenceCallbacks(){this.config.cookieTypes.forEach(e=>{let t="true"===localStorage.getItem(`virtudiacc_${e.id}${this.getBannerSuffix()}`);if(t&&"function"==typeof e.onAccept)try{e.onAccept()}catch(n){console.warn(`Error running onAccept for ${e.id}:`,n)}else if(!t&&"function"==typeof e.onReject)try{e.onReject()}catch(o){console.warn(`Error running onReject for ${e.id}:`,o)}})}loadRequiredCookies(){this.config.cookieTypes&&this.config.cookieTypes.forEach(e=>{if(e.required&&"function"==typeof e.onAccept)try{e.onAccept()}catch(t){console.warn(`Error running onAccept for ${e.id}:`,t)}})}getBannerContent(){let e=this.config.text?.banner?.title||"Your privacy matters to us.",t=this.config.text?.banner?.description||'We process your personal information to measure and improve our site and services, to assist with our marketing campaigns, and to provide personalized content and advertising. For more information, see our <a href="https://www.virtudia.com/policies/privacy" target="_blank">Privacy Policy</a>.',n=this.config.text?.banner?.acceptAllButtonText||"Accept all",o=this.config.text?.banner?.acceptAllButtonAccessibleLabel,i=`<button class="accept-all abTn abTnP"${o&&o!==n?` aria-label="${o}"`:""}>${n}</button>`,s=this.config.text?.banner?.rejectNonEssentialButtonText||"Reject non-essential",c=this.config.text?.banner?.rejectNonEssentialButtonAccessibleLabel,r=`<button class="reject-all abTn abTnS"${c&&c!==s?` aria-label="${c}"`:""}>${s}</button>`,a=this.config.text?.banner?.preferencesButtonAccessibleLabel||"Manage Preferences",l=`<button class="preferences"${a?` aria-label="${a}"`:""}><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000" aria-hidden="true"><path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"/></svg></button>`,h=`<div class="actCT"><h2>${e}</h2>${t}</div><div class="actCC"><div class="actCC-setting">${l}</div>${i}${r}</div>`;return h}hasSetInitialCookieChoices(){return!!localStorage.getItem(`ACBic${this.getBannerSuffix()}`)}removeBanner(){this.banner&&this.banner.parentNode&&(this.banner.parentNode.removeChild(this.banner),this.banner=null,"function"==typeof this.config.onBannerClose&&this.config.onBannerClose())}shouldShowBanner(){return!1!==this.config.showBanner&&null===localStorage.getItem(`ACBic${this.getBannerSuffix()}`)}createModal(){this.modal=this.createWrapperChild(this.getModalContent(),"aM")}toggleModal(e){if(this.modal){if(this.modal.style.display=e?"flex":"none",e){this.showBackdrop(),this.hideCookieIcon(),this.removeBanner(),this.preventBodyScroll();let t=this.modal.querySelector(".modal-close");t.focus(),"function"==typeof this.config.onPreferencesOpen&&this.config.onPreferencesOpen(),this.updateCheckboxState(!1)}else this.setInitialCookieChoiceMade(),this.updateCheckboxState(!0),this.hideBackdrop(),this.showCookieIcon(),this.allowBodyScroll(),"function"==typeof this.config.onPreferencesClose&&this.config.onPreferencesClose()}}getCookieIconContent(){return`<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="none"><path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"/></svg>`}createCookieIcon(){this.cookieIcon=document.createElement("button"),this.cookieIcon.id="aCi",this.cookieIcon.innerHTML=this.getCookieIconContent(),this.config.text?.banner?.preferencesButtonAccessibleLabel&&(this.cookieIcon.ariaLabel=this.config.text?.banner?.preferencesButtonAccessibleLabel),this.wrapper&&document.body.contains(this.wrapper)||this.createWrapper(),this.wrapper.appendChild(this.cookieIcon),this.cookieIcon&&this.config.cookieIcon?.position&&this.cookieIcon.classList.add(this.config.cookieIcon.position),this.cookieIcon&&this.config.cookieIcon?.colorScheme&&this.cookieIcon.classList.add(this.config.cookieIcon.colorScheme)}showCookieIcon(){this.cookieIcon&&(this.cookieIcon.style.display="none")}hideCookieIcon(){this.cookieIcon&&(this.cookieIcon.style.display="none")}handleClosedWithNoChoice(){let e={};if(this.config.cookieTypes.forEach(t=>{let n=t.required||t.defaultValue;if(e[t.id]=n,localStorage.setItem(`virtudiacc_${t.id}${this.getBannerSuffix()}`,n.toString()),n&&"function"==typeof t.onAccept)try{t.onAccept()}catch(o){console.warn(`Error running onAccept for ${t.id}:`,o)}else if(!n&&"function"==typeof t.onReject)try{t.onReject()}catch(i){console.warn(`Error running onReject for ${t.id}:`,i)}}),"function"==typeof this.config.saveConsentChoices)try{this.config.saveConsentChoices(e)}catch(t){console.warn("Error running saveConsentChoices:",t)}if("function"==typeof this.config.applyConsentChoices)try{this.config.applyConsentChoices(e)}catch(n){console.warn("Error running applyConsentChoices:",n)}this.setInitialCookieChoiceMade(),this.updateCheckboxState(),console.debug("Default options are saved when the modal is closed:",e)}getFocusableElements(e){return e.querySelectorAll('button, a[href], input, select, textarea, [tabindex]:not([tabindex="-1"])')}setupEventListeners(){this.banner&&this.setupBannerEventListeners(),this.modal&&this.setupModalEventListeners(),this.cookieIcon&&this.setupCookieIconEventListener()}setupBannerEventListeners(){let e=this.banner.querySelector(".accept-all"),t=this.banner.querySelector(".reject-all"),n=this.banner.querySelector(".preferences");this.bannerEventListeners=[];let o=(e,t,n)=>{e&&(e.addEventListener(t,n),this.bannerEventListeners.push({element:e,event:t,handler:n}))};o(e,"click",()=>{this.handleCookieChoice(!0),"function"==typeof this.config.onClickAccept&&this.config.onClickAccept()}),o(t,"click",()=>{this.handleCookieChoice(!1),"function"==typeof this.config.onClickReject&&this.config.onClickReject()}),o(n,"click",()=>{this.showBackdrop(),this.toggleModal(!0),"function"==typeof this.config.onClickPreferences&&this.config.onClickPreferences()});let i=this.getFocusableElements(this.banner),s=i[0],c=i[i.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey&&document.activeElement===s?(c.focus(),e.preventDefault()):document.activeElement===c&&(s.focus(),e.preventDefault()))};this.banner.addEventListener("keydown",r),this.bannerEventListeners.push({element:this.banner,event:"keydown",handler:r}),"wizard"!==this.config.mode&&e?.focus()}setupCookieIconEventListener(){let e=()=>{this.modal?"none"===this.modal.style.display||""===this.modal.style.display?(this.toggleModal(!0),this.hideCookieIcon()):this.toggleModal(!1):(this.createModal(),this.toggleModal(!0),this.hideCookieIcon())};this.cookieIcon.addEventListener("click",e),this.cookieIconEventListener=e}setupFocusTrap(e,t){let n=this.getFocusableElements(e),o=n[0],i=n[n.length-1];e.addEventListener("keydown",t=>{"Tab"===t.key&&(t.shiftKey?document.activeElement===o&&(i.focus(),t.preventDefault()):document.activeElement===i&&(o.focus(),t.preventDefault())),"Escape"===t.key&&e===this.modal&&this.toggleModal(!1)}),t?.focus()}getBannerSuffix(){return this.config.bannerSuffix?"_"+this.config.bannerSuffix:""}preventBodyScroll(){document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"}allowBodyScroll(){document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}getRejectedCookies(){return(this.config.cookieTypes||[]).reduce((e,t)=>(e[t.id]="false"===localStorage.getItem(`virtudiacc_${t.id}${this.getBannerSuffix()}`),e),{})}}!function(){window.aCBm={};let e={},t;function n(){if(!t){if(!e.cookieTypes||!Array.isArray(e.cookieTypes)){return}if(t=new ACB(e),console.debug("The cookie banner is initialized with the configuration:",e),"function"==typeof e.onConsentGiven){let n=t.getBannerSuffix(),o=new MutationObserver(()=>{let t=[`virtudiacc_analytics${n}`,`virtudiacc_marketing${n}`,`virtudiacc_necessary${n}`,`virtudiacc_functionality${n}`],i=t.some(e=>null!==localStorage.getItem(e));if(i){try{e.onConsentGiven()}catch(s){console.warn("Error running onConsentGiven:",s)}o.disconnect()}});o.observe(document,{subtree:!0,childList:!0})}}}window.aCBm.initCookieBanner=n,window.aCBm.updateCookieBannerConfig=function o(i={}){e={...e,...i},t&&("function"==typeof t.destroyCookieBanner&&t.destroyCookieBanner(),t=null),document.body?n():document.addEventListener("DOMContentLoaded",n,{once:!0})},window.aCBm.injectScript=function e(t,n){let o=document.querySelector(`script[src="${t}"]`);if(o)return;let i=document.createElement("script");i.src=t,"async"===n?i.async=!0:"defer"===n&&(i.defer=!0),document.head.appendChild(i)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()}();